(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const u=(s,e=document)=>e.querySelector(s);function a(s,e={},t=[]){const o=document.createElement(s);return Object.entries(e).forEach(([n,i])=>{n==="class"?o.className=i:n.startsWith("on")&&typeof i=="function"?o.addEventListener(n.slice(2),i):i!==!1&&i!=null&&o.setAttribute(n,String(i))}),(Array.isArray(t)?t:[t]).forEach(n=>{n!=null&&o.appendChild(typeof n=="string"?document.createTextNode(n):n)}),o}const F="dicoding-story",U=2;function w(){return new Promise((s,e)=>{const t=indexedDB.open(F,U);t.onupgradeneeded=o=>{const n=o.target.result;if(!n.objectStoreNames.contains("stories")){const i=n.createObjectStore("stories",{keyPath:"id",autoIncrement:!0});i.createIndex("by_status","status",{unique:!1}),i.createIndex("isSaved","isSaved",{unique:!1})}n.objectStoreNames.contains("hidden_stories")||n.createObjectStore("hidden_stories",{keyPath:"id"})},t.onsuccess=()=>s(t.result),t.onerror=()=>e(t.error)})}async function P(s){const e=await w();return new Promise((t,o)=>{const r=e.transaction("stories","readwrite").objectStore("stories").put(s);r.onsuccess=()=>t(r.result),r.onerror=()=>o(r.error)})}async function B(){const s=await w();return new Promise((e,t)=>{const i=s.transaction("stories","readonly").objectStore("stories").getAll();i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)})}async function O(s){const e=await w();return new Promise((t,o)=>{const i=e.transaction("stories","readwrite").objectStore("stories"),r={...s,isSaved:!0},d=i.put(r);d.onsuccess=()=>t(!0),d.onerror=()=>o(d.error)})}async function $(s){const e=await w();return new Promise((t,o)=>{const i=e.transaction("stories","readwrite").objectStore("stories"),r={...s,isSaved:!1},d=i.put(r);d.onsuccess=()=>t(!0),d.onerror=()=>o(d.error)})}async function K(){return(await B()).filter(e=>e.isSaved===!0)}async function H(s){const e=await w();return new Promise((t,o)=>{const r=e.transaction("stories","readwrite").objectStore("stories").delete(s);r.onsuccess=()=>t(!0),r.onerror=()=>o(r.error)})}async function I(s){const e=await w();return new Promise((t,o)=>{const r=e.transaction("hidden_stories","readwrite").objectStore("hidden_stories").put({id:s});r.onsuccess=()=>t(!0),r.onerror=()=>o(r.error)})}async function q(){const s=await w();return new Promise((e,t)=>{const i=s.transaction("hidden_stories","readonly").objectStore("hidden_stories").getAll();i.onsuccess=()=>e(i.result),i.onerror=()=>t(i.error)})}class E{constructor(e){this.container=e,this.presenter=null}render(e="#/dashboard"){if(!this.container)return;this.container.innerHTML="";let t="Hallo selamat datang di Dashboard";e==="#/storyterbaru"&&(t="Story Terbaru (Data Lokal)"),e==="#/saved"&&(t="Story yang Anda Simpan");const o=a("div",{class:"hero-text"},[a("h2",{},t)]),n=a("div",{class:"stories-grid",id:"list"}),i=a("section",{},[o,a("div",{id:"status",style:"text-align:center; color:white; margin:10px 0;"}),n,a("div",{style:"display: flex; justify-content: center; gap: 20px; margin-top: 40px;"},[a("button",{style:"background-color: white; color: #024a7d; padding: 12px 30px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer;",onclick:()=>window.location.hash="#/dashboard"},"Kembali Ke Beranda"),a("button",{style:"background-color: #ff4757; color: white; padding: 12px 30px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer;",onclick:()=>{confirm("Keluar dari aplikasi?")&&(localStorage.removeItem("token"),window.location.hash="#/")}},"Keluar Aplikasi")])]);this.container.append(i)}async renderStories(e,t=!1,o=!1){const n=document.getElementById("list");if(n)try{const r=(await q()).map(l=>l.id),d=e.filter(l=>!r.includes(l.id));n.innerHTML=d.length?"":"<p style='color:white;'>Belum ada data untuk ditampilkan.</p>",(window.location.hash==="#/dashboard"||window.location.hash==="#/"||window.location.hash==="")&&(t=!0,o=!1),d.slice(0,9).forEach(l=>{let p="";t&&(o?p=a("button",{style:"margin-top: 10px; padding: 8px 15px; background: #f39c12; border: none; color: white; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold;",onclick:async y=>{if(y.stopPropagation(),confirm("Batalkan penyimpanan story ini?")){await $(l);const g=d.filter(v=>v.id!==l.id);this.renderStories(g,t,o),alert("Story dihapus dari koleksi Simpan.")}}},"Batalkan di Simpan"):p=a("button",{style:"margin-top: 10px; padding: 8px 15px; background: #5fb8e8; border: none; color: white; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold;",onclick:async y=>{y.stopPropagation(),await O(l),alert("Story berhasil disimpan ke koleksi 'Story di Simpan'!")}},"Simpan Story"));const h=t?a("button",{style:"margin-top: 5px; padding: 8px 15px; background: #6c757d; border: none; color: white; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold;",onclick:async y=>{if(y.stopPropagation(),confirm("Sembunyikan story ini dari tampilan?"))try{await I(l.id);const g=e.filter(v=>v.id!==l.id);this.renderStories(g,t,o)}catch(g){console.error(g),alert("Gagal menyembunyikan story.")}}},"Sembunyikan Story"):"",f=t?a("button",{style:"margin-top: 5px; padding: 8px 15px; background: #ff4757; border: none; color: white; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold;",onclick:async y=>{if(y.stopPropagation(),confirm("Yakin ingin menghapus story ini secara permanen?"))try{await H(l.id),await I(l.id);const g=d.filter(v=>v.id!==l.id);this.renderStories(g,t,o),alert("Story berhasil dihapus permanen!")}catch(g){console.error(g),alert("Gagal menghapus story.")}}},"Hapus Story"):"",k=a("img",{src:l.photoUrl||l.image,alt:`Foto cerita oleh ${l.name}`,style:"width: 100%; height: 200px; object-fit: cover;"});k.onerror=()=>{k.src="https://via.placeholder.com/300?text=Gambar+Rusak"};const L=new Date(l.createdAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"}),A=a("article",{class:"card-story",style:"cursor:pointer;"},[k,a("div",{class:"card-body"},[a("h3",{class:"card-title"},l.name),a("span",{style:"display:block; font-size: 0.8rem; color: #666; margin-bottom: 5px;"},L),a("p",{class:"card-desc"},l.description),p,h,f])]);A.addEventListener("click",()=>window.location.hash=`#/detail/${l.id}`),n.appendChild(A)})}catch(i){console.error("Gagal memuat hidden stories:",i)}}showLoading(e){const t=u("#status");t&&(t.textContent=e)}}let m=null;const S=window.L;function C(s,e={}){if(m&&(m.remove(),m=null),!document.getElementById(s)||!S)return null;const{center:o=[-6.2,106.8],zoom:n=10,onClick:i}=e;return m=S.map(s).setView(o,n),S.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(m),i&&m.on("click",r=>i(r.latlng)),m}function M(s,e,t,o=""){if(!s||!S)return null;const n=S.marker([e,t]).addTo(s);return o&&n.bindPopup(o).openPopup(),n}function _(){m&&(m.remove(),m=null)}class z{constructor(e,t,o){this.video=e,this.canvas=t,this.btnCapture=o,this.stream=null,this.currentBlob=null,this._boundCapture=null}async start(e={video:!0,audio:!1}){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera API not supported in this browser.");try{this.stream=await navigator.mediaDevices.getUserMedia(e),this.video.srcObject=this.stream,this.video.setAttribute("playsinline",""),this.video.setAttribute("autoplay",""),await this.video.play(),this._boundCapture=()=>this.capture(),this.btnCapture&&this.btnCapture.addEventListener("click",this._boundCapture)}catch(t){throw new Error("Failed to start camera: "+t.message)}}stop(){if(this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.video){try{this.video.pause()}catch{}this.video.srcObject=null}this.btnCapture&&this._boundCapture&&(this.btnCapture.removeEventListener("click",this._boundCapture),this._boundCapture=null)}capture(){return new Promise((e,t)=>{if(!this.video||!this.canvas)return t(new Error("Video or canvas element is missing."));const o=this.video.videoWidth||this.video.clientWidth,n=this.video.videoHeight||this.video.clientHeight;if(!o||!n)return t(new Error("Video metadata not ready."));const i=this.canvas.getContext("2d");if(!i)return t(new Error("2D context not available on canvas."));if(this.canvas.width=o,this.canvas.height=n,i.drawImage(this.video,0,0,o,n),this.canvas.toBlob)this.canvas.toBlob(r=>{if(!r)return t(new Error("Failed to create image blob."));this.currentBlob=r,e(r)},"image/jpeg",.9);else try{const d=this.canvas.toDataURL("image/jpeg",.9).split(","),c=d[0].match(/:(.*?);/)[1],l=atob(d[1]);let p=l.length;const h=new Uint8Array(p);for(;p--;)h[p]=l.charCodeAt(p);const f=new Blob([h],{type:c});this.currentBlob=f,e(f)}catch(r){t(r)}})}getBlob(){return this.currentBlob}}class R{constructor(e){this.container=e,this.presenter=null,this._cam=null,this._map=null,this._marker=null,this._picked=null}async _toBase64(e){return new Promise((t,o)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=i=>o(i),n.readAsDataURL(e)})}render(){if(!this.container)return;this.container.innerHTML="";const e=a("div",{class:"hero-text"},[a("h2",{},"Tambah Story"),a("p",{},"Unggah foto dan pilih lokasimu di peta.")]),t=a("form",{id:"addForm",class:"panel-container"},[a("div",{class:"panel-box"},[a("label",{class:"panel-title"},"1. Foto & Cerita"),a("label",{for:"fileInput",style:"margin-bottom:5px; display:block;"},"Pilih Foto:"),a("div",{class:"kv",style:"display:flex; gap:10px; margin-bottom:10px;"},[a("button",{type:"button",id:"openCam",class:"button",style:"font-size:0.8rem; flex:1; padding:8px;"},"Buka Kamera"),a("input",{type:"file",id:"fileInput",accept:"image/*",style:"color:white; flex:2;"})]),a("div",{class:"kv",style:"flex-direction:column"},[a("video",{id:"video",playsinline:!0,style:"width:100%; border-radius:.5rem; display:none; margin-bottom:10px;"}),a("canvas",{id:"canvas",style:"width:100%; border-radius:.5rem; display:none; margin-bottom:10px;"}),a("button",{type:"button",id:"capture",class:"button warn",style:"display:none; width:100%;"},"Ambil Foto")]),a("label",{for:"desc",style:"margin-top:1rem; display:block;"},"Deskripsi:"),a("textarea",{id:"desc",name:"description",required:!0,maxlength:300,style:"color:black; width:100%;"})]),a("div",{class:"panel-box"},[a("label",{class:"panel-title"},"2. Lokasi (Wajib Dipilih)"),a("div",{id:"add-story-map",style:"height: 300px; width: 100%; border-radius: 10px;"}),a("p",{class:"helper"},["Koordinat: ",a("span",{id:"picked",style:"font-weight:bold; color: #ffeb3b;"},"Belum dipilih")]),a("button",{type:"submit",class:"btn-upload"},"Kirim Story")]),a("div",{id:"status",style:"width:100%; text-align:center; margin-top: 10px; font-weight: bold; color: white;"})]),o=a("div",{style:"display: flex; justify-content: center; gap: 20px; margin-top: 40px; padding-bottom: 30px;"},[a("button",{style:"background-color: white; color: #024a7d; padding: 12px 30px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer;",onclick:()=>window.location.hash="#/dashboard"},"Kembali Ke Beranda"),a("button",{style:"background-color: #ff4757; color: white; padding: 12px 30px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer;",onclick:()=>{confirm("Keluar dari aplikasi?")&&(localStorage.removeItem("token"),window.location.hash="#/")}},"Keluar Aplikasi")]);this.container.append(e,t,o);const n=u("#video"),i=u("#canvas"),r=u("#capture");this._cam=new z(n,i,r),u("#openCam").addEventListener("click",()=>{var d;n.style.display="block",r.style.display="inline-block",(d=this._cam)==null||d.start()}),requestAnimationFrame(()=>{_(),this._map=C("add-story-map",{center:[-6.2,106.8],zoom:5,onClick:d=>{this._picked=d,u("#picked").textContent=`${d.lat.toFixed(6)}, ${d.lng.toFixed(6)}`,this._marker&&this._map.removeLayer(this._marker),this._marker=M(this._map,d.lat,d.lng)}})}),u("#addForm").addEventListener("submit",async d=>{if(d.preventDefault(),!this._picked)return alert("Pilih lokasi di peta!");const c=u("#desc").value,l=u("#fileInput").files[0];let p="https://via.placeholder.com/300";i.style.display!=="none"?p=i.toDataURL():l&&(p=await this._toBase64(l));const h=Number(this._picked.lat),f=Number(this._picked.lng),k={id:`local-${Date.now()}`,name:"Saya (Lokal)",description:c,photoUrl:p,createdAt:new Date().toISOString(),lat:h,lon:f};try{this.showLoading("Menyimpan data...","white"),await P(k),this.presenter&&this.presenter.addStory({description:c,photo:l||this._cam.getImageFile(),lat:h,lon:f}),this.showLoading("Story berhasil di tambahkan dan di simpan","#4caf50"),u("#addForm").reset(),n.style.display="none",i.style.display="none",r.style.display="none",this._marker&&(this._map.removeLayer(this._marker),this._marker=null),this._picked=null,u("#picked").textContent="Belum dipilih",setTimeout(()=>{this.showLoading("")},3e3)}catch(L){console.error(L),this.renderError("Gagal menyimpan story.")}})}showLoading(e,t="white"){const o=u("#status");o&&(o.textContent=e,o.style.color=t)}renderError(e){const t=u("#status");t&&(t.textContent=e,t.style.color="red")}destroy(){var e;_(),(e=this._cam)==null||e.stop()}}class G{constructor(e){this.container=e,this.presenter=null,this._map=null}render(){if(!this.container)return;this.container.innerHTML="";const e=a("div",{class:"hero-text",style:"text-align:left; margin-bottom: 20px;"},[a("h2",{},"Detail status kamu")]),t=a("div",{id:"loading",style:"text-align:center; color:white;"},"Sedang memuat data..."),o=a("div",{id:"detailContent",style:"display: none; grid-template-columns: 1fr 1fr; gap: 20px;"});this.container.append(e,t,o)}showDetail(e){u("#loading")&&(u("#loading").style.display="none");const t=u("#detailContent");if(!t)return;t.style.display="grid",t.innerHTML="";const o=a("img",{src:e.photoUrl||e.image,alt:`Foto detail milik ${e.name}`,style:"width:100%; height:300px; object-fit:cover;"});o.onerror=()=>{o.src="https://via.placeholder.com/600?text=Gambar+Tidak+Ditemukan"};const n=a("div",{class:"card-story",style:"background:white; border-radius:10px; overflow:hidden;"},[o,a("div",{class:"card-body",style:"padding:15px; color:#333;"},[a("h3",{style:"margin-bottom:5px;"},e.name),a("p",{style:"color:#666;"},e.description),a("small",{style:"display:block; margin-top:10px; color:#999;"},new Date(e.createdAt).toLocaleString("id-ID",{dateStyle:"full",timeStyle:"short"}))])]),i=Number(e.lat),r=Number(e.lon),d=!isNaN(i)&&!isNaN(r)&&i!==0,c="detail-map",l=a("div",{class:"panel-box"},[a("h4",{style:"color:white; margin-bottom:10px;"},"Lokasi Status Mu :"),a("div",{id:c,style:"width:100%; height:250px; background:#eee; border-radius:8px; margin-bottom:10px;"}),a("p",{style:"color:#ffeb3b; font-weight:bold;"},d?`${i}, ${r}`:"Lokasi tidak tersedia")]);t.append(n,l),d&&setTimeout(()=>{this._map&&this._map.remove(),this._map=C(c,{center:[i,r],zoom:13});const h=`<div style="text-align:center;"><b>${e.name}</b><br>${e.description}</div>`;M(this._map,i,r,h)},500);const p=a("div",{style:"grid-column: 1 / -1; display: flex; justify-content: center; gap: 20px; margin-top: 20px; flex-wrap: wrap;"},[a("button",{style:"background:white; color:#024a7d; padding:12px 30px; border-radius:50px; cursor:pointer; font-weight:bold; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);",onclick:()=>window.location.hash="#/dashboard"},"Kembali ke Beranda"),a("button",{style:"background:#5fb8e8; color:white; padding:12px 30px; border-radius:50px; cursor:pointer; font-weight:bold; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);",onclick:()=>window.location.hash="#/storyterbaru"},"Kembali ke Story Terbaru")]);t.append(p)}}class D{constructor(e,t){this.view=e,this.model=t,this.initListener()}initListener(){window.addEventListener("online",()=>{this.syncPendingStories()})}async getDetail(e){try{if(this.view.showLoading&&this.view.showLoading("Sedang mengambil detail..."),e&&(e.startsWith("dummy-")||e.startsWith("story-")&&e.length<10)){const n={id:e,name:"Pengguna (Data Dummy)",description:"Ini adalah data simulasi karena ID ini tidak ada di server.",photoUrl:`https://picsum.photos/seed/${e}/600/400`,lat:-6.2,lon:106.816666};await new Promise(i=>setTimeout(i,500)),this.view.showDetail&&this.view.showDetail(n);return}const t=await this.model.getDetail(e);if(t.error)throw new Error(t.message);const o=t.story;this.view.showDetail&&this.view.showDetail(o)}catch(t){console.error("Gagal getDetail:",t),this.view.renderError&&this.view.renderError("Gagal memuat detail story. Pastikan koneksi lancar atau ID valid.")}}async addStory(e){try{this.view.showLoading&&this.view.showLoading(!0),await this.model.addStory(e),this.view.renderSuccess&&this.view.renderSuccess("Berhasil diupload!")}catch(t){console.warn("Offline, simpan IDB...",t);const o={id:`offline-${Date.now()}`,payload:{description:e.description},status:"pending",createdAt:Date.now()};await P(o),this.view.renderSuccess&&this.view.renderSuccess("Disimpan offline.")}finally{this.view.showLoading&&this.view.showLoading(!1)}}async loadStories(){try{this.view.showLoading&&this.view.showLoading("Memuat cerita...");let e=[];try{e=(await this.model.getStories()).listStory||[]}catch{console.log("Offline/API Error")}const t=[];for(let n=1;n<=9;n++)t.push({id:`dummy-${n}`,name:`Pengguna ${n}`,description:`Contoh deskripsi dummy ${n}`,photoUrl:`https://picsum.photos/seed/${n}/600/400`,lat:-6.2,lon:106.8});const o=[...e,...t];this.view.renderStories&&this.view.renderStories(o)}catch{this.view.renderError&&this.view.renderError("Gagal memuat data.")}}async syncPendingStories(){}}const b="https://story-api.dicoding.dev/v1";class N{constructor(e){this.tokenProvider=e}getToken(){return this.tokenProvider()}async register({name:e,email:t,password:o}){const n=await fetch(`${b}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:o})});if(!n.ok)throw new Error("REGISTER_FAILED");return n.json()}async login({email:e,password:t}){const o=await fetch(`${b}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!o.ok)throw new Error("LOGIN_FAILED");return(await o.json()).loginResult.token}async getStories({page:e=1,size:t=15,withLocation:o=!0}={}){const n=this.tokenProvider();if(!n)throw new Error("UNAUTHORIZED");const i=new URL(`${b}/stories`);i.searchParams.set("page",e),i.searchParams.set("size",t),i.searchParams.set("location",o?"1":"0");const r=await fetch(i,{headers:{Authorization:`Bearer ${n}`}});if(!r.ok)throw new Error("GET_STORIES_FAILED");return r.json()}async getDetail(e){const t=this.tokenProvider();if(!t)throw new Error("UNAUTHORIZED");const o=await fetch(`${b}/stories/${e}`,{headers:{Authorization:`Bearer ${t}`}});if(!o.ok)throw new Error("DETAIL_FAILED");return o.json()}async addStory({description:e,photo:t,lat:o,lon:n}){const i=this.tokenProvider();if(!i)throw new Error("UNAUTHORIZED");const r=new FormData;r.append("description",e),r.append("photo",t),o&&r.append("lat",o),n&&r.append("lon",n);const d=await fetch(`${b}/stories`,{method:"POST",headers:{Authorization:`Bearer ${i}`},body:r});if(!d.ok)throw new Error("ADD_STORY_FAILED");return d.json()}async addStoryGuest({description:e,file:t,lat:o,lon:n}){const i=new FormData;i.append("description",e),t&&i.append("photo",t),typeof o=="number"&&i.append("lat",String(o)),typeof n=="number"&&i.append("lon",String(n));const r=await fetch(`${b}/stories/guest`,{method:"POST",body:i});if(!r.ok)throw new Error("ADD_STORY_FAILED");return r.json()}async subscribeToPush(e){const t=this.tokenProvider(),o=await fetch(`${b}/notifications/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!o.ok){const n=await o.json();throw new Error(n.message||"SUBSCRIBE_FAILED_SERVER")}return o.json()}async unsubscribeFromPush(e){const t=this.tokenProvider(),o=await fetch(`${b}/notifications/subscribe`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({endpoint:e})}),n=await o.json();if(!o.ok)throw new Error(n.message||"Gagal unsubscribe dari server");return n}}const W="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk";class V{constructor(e){this.content=e,this.model=new N(()=>localStorage.getItem("token"))}render(){this.content.innerHTML=`
      <section style="padding: 20px; text-align: center; max-width: 600px; margin: 50px auto;">
        <h2>Pengaturan Notifikasi</h2>
        <p style="margin-bottom: 20px;">Aktifkan notifikasi untuk mendapatkan update berita terbaru.</p>
        
        <div id="msg-box" style="margin-bottom: 20px; font-weight: bold;"></div>
        
        <button id="btnSubscribe" style="display: none; background-color: #024a7d; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;">
          Aktifkan Notifikasi
        </button>
        
        <button id="btnUnsubscribe" style="display: none; background-color: #ff4757; color: white; padding: 12px 24px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;">
          Matikan Notifikasi
        </button>
      </section>
    `,this._initLogic()}async _initLogic(){const e=document.getElementById("btnSubscribe"),t=document.getElementById("btnUnsubscribe"),o=document.getElementById("msg-box");if(!("serviceWorker"in navigator)||!("PushManager"in window)){o.innerText="Maaf, browser ini tidak mendukung Push Notification.";return}const n=await navigator.serviceWorker.ready;await n.pushManager.getSubscription()?(e.style.display="none",t.style.display="inline-block",console.log("Status: Sudah Subscribe")):(e.style.display="inline-block",t.style.display="none",console.log("Status: Belum Subscribe")),e.addEventListener("click",async()=>{try{if(o.innerText="Meminta izin notifikasi...",await Notification.requestPermission()!=="granted"){o.innerText="Izin notifikasi ditolak.";return}o.innerText="Mendaftarkan ke browser...";const d={userVisibleOnly:!0,applicationServerKey:this._urlBase64ToUint8Array(W)},c=await n.pushManager.subscribe(d),l=btoa(String.fromCharCode.apply(null,new Uint8Array(c.getKey("p256dh")))),p=btoa(String.fromCharCode.apply(null,new Uint8Array(c.getKey("auth")))),h={endpoint:c.endpoint,keys:{p256dh:l,auth:p}};o.innerText="Mengirim data ke server...",await this.model.subscribeToPush(h),console.log("Berhasil Subscribe ke Server:",h),o.innerText="Berhasil mengaktifkan notifikasi!",e.style.display="none",t.style.display="inline-block"}catch(r){console.error(r),o.innerText="Gagal subscribe: "+r.message;const d=await n.pushManager.getSubscription();d&&await d.unsubscribe()}}),t.addEventListener("click",async()=>{try{const r=await n.pushManager.getSubscription();r&&(o.innerText="Menghapus langganan di server...",await this.model.unsubscribeFromPush(r.endpoint),await r.unsubscribe(),console.log("Berhasil Unsubscribe"),o.innerText="Notifikasi dimatikan.",e.style.display="inline-block",t.style.display="none")}catch(r){console.error(r),o.innerText="Gagal unsubscribe: "+r.message}})}_urlBase64ToUint8Array(e){const t="=".repeat((4-e.length%4)%4),o=(e+t).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(o),i=new Uint8Array(n.length);for(let r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return i}}const J=`
  <div class="landing-container">
    <h1 class="landing-title">Selamat datang di Dylan Story Super App</h1>
    <div class="landing-image-wrapper">
       <img src="https://images.unsplash.com/photo-1533738363-b7f9aef128ce?q=80&w=400&auto=format&fit=crop" 
            alt="Kucing Lucu" class="landing-image"
            style="display:block; border-radius:10px; width:300px; height:300px; object-fit:cover; margin: 0 auto; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
    </div>
    <div class="landing-buttons">
      <a href="#/login" class="btn-landing">Login</a>
      <a href="#/register" class="btn-landing">Register</a>
    </div>
  </div>
`,Y=`
  <div class="auth-container">
    <div class="login-box">
      <h2>Masuk</h2>
      <form id="loginForm">
        <div class="input-group"><label>Email</label><input type="email" id="email" required class="form-control"></div>
        <div class="input-group"><label>Kata Sandi</label><input type="password" id="password" required class="form-control"></div>
        <button type="submit" class="btn-auth" id="loginBtn">Masuk</button>
      </form>
      <button class="btn-back" id="backBtn">Kembali</button>
      <p style="margin-top:10px">Belum punya akun? <a href="#/register">Daftar di sini</a></p>
    </div>
  </div>
`,Z=`
  <div class="auth-container">
    <div class="register-box">
      <h2>Daftar</h2>
      <form id="registerForm">
        <div class="input-group"><label>Nama</label><input type="text" id="name" required class="form-control"></div>
        <div class="input-group"><label>Email</label><input type="email" id="email" required class="form-control"></div>
        <div class="input-group"><label>Kata Sandi</label><input type="password" id="password" required class="form-control"></div>
        <button type="submit" class="btn-auth" id="regBtn">Daftar</button>
      </form>
      <button class="btn-back" id="backBtn">Kembali</button>
      <p style="margin-top:10px">Sudah punya akun? <a href="#/login">Login di sini</a></p>
    </div>
  </div>
`,j=async()=>{const s=window.location.hash||"#/",e=document.querySelector("#mainContent"),t=document.querySelector("header"),o=document.querySelector("#push-notification-btn");if(!e)return;s==="#/"||s==="#/login"||s==="#/register"?(document.body.className="auth-page",t&&t.classList.add("hidden"),o&&(o.style.display="none")):(document.body.className="app-page",t&&t.classList.remove("hidden"),o&&(o.style.display="flex")),e.innerHTML="";const n=new N(()=>localStorage.getItem("token"));try{if(s==="#/")e.innerHTML=J;else if(s==="#/login")e.innerHTML=Y,document.getElementById("loginForm").addEventListener("submit",async i=>{i.preventDefault();const r=document.getElementById("email").value,d=document.getElementById("password").value;try{const c=await n.login({email:r,password:d});localStorage.setItem("token",c),window.location.hash="#/dashboard"}catch(c){alert("Login Gagal: "+c.message)}}),document.getElementById("backBtn").addEventListener("click",()=>window.location.hash="#/");else if(s==="#/register")e.innerHTML=Z,document.getElementById("registerForm").addEventListener("submit",async i=>{i.preventDefault();const r=document.getElementById("name").value,d=document.getElementById("email").value,c=document.getElementById("password").value;try{await n.register({name:r,email:d,password:c}),alert("Berhasil! Silakan Login."),window.location.hash="#/login"}catch(l){alert("Registrasi Gagal: "+l.message)}}),document.getElementById("backBtn").addEventListener("click",()=>window.location.hash="#/");else if(s==="#/dashboard"){const i=new E(e),r=new D(i,n);i.presenter=r,i.render(s),i.showLoading("Memuat data dari server..."),r.loadStories(),x(s)}else if(s==="#/storyterbaru"){const i=new E(e);i.render(s);const r=await B();i.renderStories(r,!0,!1),x(s)}else if(s==="#/saved"){const i=new E(e);i.render(s);const r=await K();i.renderStories(r,!0,!0),x(s)}else if(s==="#/about")Q(e),x(s);else if(s==="#/add"){const i=new R(e),r=new D(i,n);i.presenter=r,i.render(),x(s)}else if(s==="#/notification")new V(e).render(),x(s);else if(s.startsWith("#/detail/")){const i=s.split("/")[2],r=new G(e);if(r.render(),i.startsWith("local-"))(async()=>{try{const l=(await B()).find(p=>p.id===i);l?r.showDetail(l):e.innerHTML='<h2 style="text-align:center; margin-top:50px;">Data Lokal Tidak Ditemukan</h2>'}catch(c){console.error(c),e.innerHTML='<p style="color:red; text-align:center;">Gagal memuat data lokal.</p>'}})();else{const d=new D(r,n);r.presenter=d,d.getDetail(i)}}else e.innerHTML='<h2 style="text-align:center; margin-top:50px;">404 Not Found</h2>'}catch(i){console.error(i),e.innerHTML=`<p style="color:red; text-align:center;">Error: ${i.message}</p>`}};function x(s){document.querySelectorAll(".app-bar__navigation a").forEach(e=>{const t=e.getAttribute("href");t===s||s.startsWith("#/dashboard")&&t==="#/dashboard"?e.setAttribute("aria-current","page"):e.removeAttribute("aria-current")})}window.addEventListener("hashchange",j);window.addEventListener("load",j);const T=document.querySelector("#push-notification-btn");T&&T.addEventListener("click",()=>{window.location.hash="#/notification"});"serviceWorker"in navigator&&window.addEventListener("load",async()=>{try{const s=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registered with scope:",s.scope)}catch(s){console.error("Service Worker registration failed:",s)}});function Q(s){if(!s)return;s.innerHTML="";const e=a("div",{class:"hero-text",style:"margin-bottom: 30px;"},[a("h2",{style:"font-size: 2.2rem; margin-bottom: 10px; font-weight: 800;"},"Merangkai Momen, Mengabadikan Cerita"),a("p",{style:"font-size: 1.1rem; opacity: 0.9; font-weight: 300;"},"Karena setiap detik berharga, kami hadir untuk menyimpannya.")]),t=(i,r,d)=>a("div",{style:"background: #f8fbff; padding: 20px; border-radius: 12px; transition: transform 0.3s; text-align: center;"},[a("div",{style:"font-size: 2rem; margin-bottom: 10px;"},i),a("h4",{style:"color: #024a7d; margin-bottom: 8px; font-size: 1.1rem; font-weight: bold;"},r),a("p",{style:"font-size: 0.9rem; color: #555; line-height: 1.5;"},d)]),o=a("div",{style:"background: white; border-radius: 20px; padding: 40px; color: #333; text-align: left; box-shadow: 0 10px 30px rgba(0,0,0,0.15); max-width: 850px; margin: 0 auto;"},[a("img",{src:"https://images.unsplash.com/photo-1522202176988-66273c2fd55f?q=80&w=800&auto=format&fit=crop",alt:"Connecting People",style:"width: 100%; height: 280px; object-fit: cover; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"}),a("h3",{style:"color: #024a7d; margin-bottom: 20px; font-size: 1.6rem;"},"Visi Kami"),a("p",{style:"line-height: 1.8; color: #444; margin-bottom: 20px; font-size: 1.05rem;"},"Selamat datang di <strong>Dylan Story Super APP</strong>, sebuah ruang digital yang dirancang untuk menghubungkan hati melalui cerita."),a("p",{style:"line-height: 1.8; color: #444; margin-bottom: 30px; font-size: 1.05rem;"},"Dibangun dengan integrasi teknologi terkini, kami memungkinkan Anda berbagi momen secara <em>real-time</em>."),a("p",{style:"line-height: 1.8; color: #888; margin-bottom: 30px; font-size: 0.9rem; font-style: italic; text-align: right;"},"Versi 5.0 - Edisi 2025"),a("div",{style:"display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 30px; padding-top: 30px; border-top: 1px solid #eee;"},[t("âš¡","Performa Kilat","Akses instan ke kenangan manismu tanpa waktu tunggu."),t("ðŸ—ºï¸","Jejak Petualangan","Tandai koordinat presisi di mana cerita itu bermula."),t("âœˆï¸","Mode Traveler","Simpan cerita saat offline, otomatis sinkron saat online."),t("ðŸ”’","Ruang Privat","Data lokal Anda tersimpan aman, kendali penuh di tangan Anda.")])]),n=a("div",{style:"display: flex; justify-content: center; gap: 20px; margin-top: 40px; padding-bottom: 40px; flex-wrap: wrap;"},[a("button",{style:"background-color: white; color: #024a7d; padding: 12px 35px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.2s;",onclick:()=>window.location.hash="#/dashboard"},"Kembali Ke Beranda"),a("button",{style:"background-color: #ff4757; color: white; padding: 12px 35px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 71, 87, 0.4); transition: transform 0.2s;",onclick:()=>{confirm("Yakin ingin meninggalkan aplikasi?")&&(localStorage.removeItem("token"),window.location.hash="#/")}},"Keluar Aplikasi")]);s.append(e,o,n)}
